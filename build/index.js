!function(e){var t={};function o(r){if(t[r])return t[r].exports;var c=t[r]={i:r,l:!1,exports:{}};return e[r].call(c.exports,c,c.exports,o),c.l=!0,c.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)o.d(r,c,function(t){return e[t]}.bind(null,c));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=9)}([function(e,t){e.exports=window.wp.i18n},function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.wp.blocks},function(e,t){e.exports=window.wp.components},function(e,t){e.exports=window.wp.apiFetch},function(e,t){e.exports=window.wp.data},function(e,t){e.exports=window.wp.plugins},function(e,t){e.exports=window.lodash},function(e,t){e.exports=window.wp.editPost},function(e,t,o){"use strict";o.r(t);var r=o(0),c=o(2),n=o(6),i=o(1),l=o(7),s=o(4),p=o.n(s),a=o(5),b=o(8),u=o(3),d=Object(u.withNotices)(({clientId:e,attributes:t,noticeOperations:o,noticeUI:n})=>{Object(i.useEffect)(()=>{t.file&&d(t.file)},[]);const[l,s]=Object(i.useState)(!1),{replaceBlocks:b}=Object(a.useDispatch)("core/block-editor"),d=t=>{s(!0);const n=t[0];if("application/json"!==n.type){const e=[Object(i.createElement)("strong",{key:"filename"},n.name),": ",Object(r.__)("Sorry, only JSON files are supported here.","blocks-export-import")];return o.removeAllNotices(),o.createErrorNotice(e),void s(!1)}const l=new FileReader;l.onload=async()=>{let t;try{t=JSON.parse(l.result)}catch(e){return o.removeAllNotices(),o.createErrorNotice(Object(r.__)("Invalid JSON file","blocks-export-import")),void s(!1)}if(t.__file&&t.content&&"wp_export"===t.__file&&(t=Object(c.parse)(t.content)),t.__file&&t.content&&"wp_block"===t.__file){const e=await p()({path:"/wp/v2/types/wp_block"}),n=await p()({path:"/wp/v2/"+e.rest_base,data:{title:t.title||Object(r.__)("Untitled Reusable Block","blocks-export-import"),content:t.content,status:"publish"},method:"POST"});if(!n.id)return o.removeAllNotices(),o.createErrorNotice(Object(r.__)("Invalid Reusable Block JSON file","blocks-export-import")),void s(!1);t=`\x3c!-- wp:block { "ref": ${n.id} } /--\x3e`,t=Object(c.parse)(t)}b(e,t),s(!1)},l.readAsText(n)};return l?Object(i.createElement)(u.Placeholder,null,Object(i.createElement)(u.Spinner,null)):Object(i.createElement)(u.Placeholder,{label:Object(r.__)("Import Blocks from JSON","blocks-export-import"),instructions:Object(r.__)("Upload JSON file from your device.","blocks-export-import"),icon:"category",notices:n},Object(i.createElement)(u.FormFileUpload,{accept:"text/json",onChange:e=>d(e.target.files),isSecondary:!0},Object(r.__)("Upload")),Object(i.createElement)(u.DropZone,{label:Object(r.__)("Import from JSON","blocks-export-import"),onFilesDrop:d}))});Object(c.registerBlockType)("blocks-export-import/importer",{title:Object(r.__)("Import Blocks from JSON","blocks-export-import"),description:Object(r.__)("Allows you import blocks from a JSON file.","blocks-export-import"),icon:"category",category:"widgets",keywords:[Object(r.__)("JSON","blocks-export-import"),Object(r.__)("Importer","blocks-export-import"),Object(r.__)("Import","blocks-export-import")],attributes:{file:{type:"object"}},transforms:{from:[{type:"files",isMatch:e=>"application/json"===e[0].type,transform:e=>Object(c.createBlock)("blocks-export-import/importer",{file:e})}]},edit:d,save:()=>null}),Object(n.registerPlugin)("blocks-export-import",{render:()=>{const{blocks:e,count:t}=Object(a.useSelect)(e=>{const{getSelectedBlockCount:t,getSelectedBlock:o,getMultiSelectedBlocks:r}=e("core/block-editor");return{blocks:1===t()?o():r(),count:t()}}),{createNotice:o}=Object(a.useDispatch)("core/notices");return Object(i.createElement)(b.PluginBlockSettingsMenuItem,{icon:"share-alt2",label:Object(r.__)("Export as JSON","blocks-export-import"),onClick:async()=>{if(!e)return;let n,i;if(1===t&&"core/block"===e.name){const t=e.attributes.ref,r=await p()({path:"/wp/v2/types/wp_block"});let c;try{c=await p()({path:`/wp/v2/${r.rest_base}/${t}?context=edit`})}catch(e){return void(e.message&&o("error",e.message,{type:"snackbar"}))}const s=c.title.raw,a=c.content.raw;i=Object(l.kebabCase)(s)+".json",n={__file:"wp_block",title:s,content:a}}else i="blocks-export.json",n={__file:"wp_export",version:2,content:Object(c.serialize)(e)};const s=JSON.stringify({...n},null,2);o("success",Object(r.__)("Blocks exported.","blocks-export-import"),{type:"snackbar"}),((e,t,o)=>{const r=new window.Blob([t],{type:"application/json"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,e);else{const t=document.createElement("a");t.href=URL.createObjectURL(r),t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}})(i,s)}})}})}]);